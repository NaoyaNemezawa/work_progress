<%= render "projects/header" %>
<%= render "projects/error_flash" %>
<div class="container-fliid d-flex h_calc100vh-40px">
  <%# プロジェクト一覧 %>
  <%= render "projects/side_bar"%>
  <%# タスク一覧 %>
  <%= render "projects/middle_ber", project: @project, tasks: @tasks %>
  <%# コメント画面 %>
  <div class="col-7 p-0 bg-eee"> 
    <div class="mx-2 my-1 border bg-white d-flex justify-content-between">
      <div class="w-90">
        <div class="m-1"><%= @task.name %></div><%# タスク名 %>
        <div class="h50px m-1 overflow-auto"><%= @task.specifics %></div><%# タスク詳細 %>
      </div>
      <%# タスク用ドロップボタン %>
      <div class="align-self-center mx-auto doropdown">
        <div class="dropdown cursor-pointer" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> 
          編集
        </div>
        <div class="dropdown-menu dropdown-menu-right">
          <div class="dropdown-item cursor-pointer f-size14 px-1" data-toggle="modal" data-target="#modal1">
            タスク名を変更する
          </div>
          <div class="dropdown-item cursor-pointer f-size14 px-1" data-toggle="modal" data-target="#modal100">
            タスクを削除する
          </div>
        </div>
      </div>
      <%# ドロップボタンここまで %>
    </div>
    <%= form_with model: @comment, url:project_task_comments_path(@project.id,@task.id), class:"h50px d-flex", local: true do |f| %>
      <%= f.text_field :comment, class:"h-75 w-75 mx-2 outline align-self-center", placeholder:"コメント" %>
      <%= f.submit "コメントする", class:"h-75 align-self-center" %>
    <% end %>
    <div class="overflow-auto">
    <%# タスクの詳細とコメント一覧 %>
      <% @comments.each do |comment| %>
        <div class="d-flex justify-content-between py-1 m-2">
          <a href="#" class="text-reset py-2 my-auto mx-1">
          <%= comment.comment %></a>
          <div class="d-flex align-items-center px-2">
            <a href="#" class="f-size12 text-reset p-1 mx-1">
            編集</a>
            <%=link_to "削除",project_task_comment_path(@project.id,@task.id,comment.id),method: :delete, class: "f-size12 text-reset p-1 mx-1" %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <%# コメント画面ここまで %>
</div>

<%# モーダル %>
<%# タスク編集用 %>
<div class="modal fade" id="modal1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="text-center">
        <div class="border-bottom my-2 pb-1">
          <%= @task.name %>を変更します。
        </div>
        <%= form_with model: @task, url:project_task_path(@project.id,@task.id), local: true do |f| %>
          <%= f.text_field :name, class: "outline w-90 my-1", placeholder:"タスクネーム"%>
          <%= f.text_area :specifics, class: "outline w-90 my-1", placeholder:"タスク詳細（任意）"%>
          <%= f.submit "編集する",class:"my-1" %>
        <% end %>
      </div>
    </div>
  </div>
</div>
<%# タスク削除用 %>
<div class="modal fade" id="modal100">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="text-center border-bottom my-2 text-danger">
        <p class="mb-1">タスク：<%= @task.name %>を削除します。</p>
        <p class="mb-1">本当によろしいですか。</p>
      </div>
      <div class="d-flex justify-content-center mb-2">
        <%= link_to "削除する", project_task_path(@project.id,@task.id), method: :delete, class:"bg-danger text-white px-2 mr-4 cursor-pointer" %>
        <div class="bg-secondary text-white ml-4 cursor-pointer" data-dismiss="modal">
        キャンセル</div>
      </div>
    </div>
  </div>
</div>